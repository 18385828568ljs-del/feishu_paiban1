import{$ as m,d as le,u as ne,r as v,X as S,o as ie,c as i,b as t,f as b,e as k,g as A,t as g,F as z,h as P,C as N,w as _,v as E,a0 as re,Z as de,p as ue,E as c,l as I,n as ve,i as ce,j as r,_ as pe}from"./index-mInWaxl3.js";import{t as me}from"./templates-DCFN9nDS.js";const h="https://zhinengpaiban.cn",w={async createTeam(l,n,u){return(await m.post(`${h}/api/team/create?feishu_user_id=${l}`,{name:n,description:u})).data},async getMyTeam(l){return(await m.get(`${h}/api/team/my-team?feishu_user_id=${l}`)).data},async getMembers(l,n){return(await m.get(`${h}/api/team/${l}/members?feishu_user_id=${n}`)).data},async inviteMember(l,n,u){return(await m.post(`${h}/api/team/${l}/invite?feishu_user_id=${n}`,{invitee_feishu_id:u||null})).data},async acceptInvite(l,n){return(await m.post(`${h}/api/team/accept-invite`,{feishu_user_id:l,invite_code:n})).data},async removeMember(l,n,u){await m.delete(`${h}/api/team/${l}/members/${n}?feishu_user_id=${u}`)},async leaveTeam(l,n){await m.post(`${h}/api/team/${l}/leave?feishu_user_id=${n}`)},async dissolveTeam(l,n){await m.delete(`${h}/api/team/${l}/dissolve?feishu_user_id=${n}`)},async updateMemberRole(l,n,u,d){await m.put(`${h}/api/team/${l}/members/${n}/role?feishu_user_id=${u}`,{role:d})},async shareTemplate(l,n,u,d=!1){await m.post(`${h}/api/team/${l}/templates/share?feishu_user_id=${n}`,{template_id:u,can_edit:d})},async getTeamTemplates(l,n){return(await m.get(`${h}/api/team/${l}/templates?feishu_user_id=${n}`)).data},async unshareTemplate(l,n,u){await m.delete(`${h}/api/team/${l}/templates/${n}?feishu_user_id=${u}`)}},he={class:"team-page"},we={class:"back-home"},ge={key:0,class:"loading-state"},be={key:1,class:"no-team"},ke={class:"no-team-content"},ye={class:"actions"},fe={key:2,class:"team-content"},_e={class:"team-info-card"},xe={class:"team-header"},$e={class:"team-details"},Ce={class:"team-name"},Me={class:"team-desc"},Te={class:"team-stats"},Be={class:"stat-item"},Ve={class:"stat-value"},je={class:"stat-label"},Ie={class:"section"},De={class:"section-header"},Ue={class:"member-list"},He={class:"member-avatar"},Ae={class:"member-info"},Ne={class:"member-name"},Ee={key:0,class:"member-actions"},Re=["onClick"],Le=["onClick"],Se={class:"section"},ze={class:"section-header"},Pe={key:0,class:"empty-state"},Fe={key:1,class:"template-list"},Ze={class:"template-info"},Je={class:"template-name"},Oe={class:"template-meta"},Xe={key:0,class:"badge"},qe={key:0,class:"template-actions"},Ge=["onClick"],Ke={class:"leave-section"},Qe={class:"dialog"},We={class:"dialog-body"},Ye={class:"form-group"},et={class:"form-group"},tt={class:"dialog-footer"},st=["disabled"],at={class:"dialog"},ot={class:"dialog-body"},lt={class:"form-group"},nt={class:"dialog-footer"},it=["disabled"],rt={class:"dialog"},dt={class:"dialog-body"},ut={class:"form-group"},vt={key:0,class:"invite-result"},ct={class:"invite-code"},pt={class:"dialog-footer"},mt={class:"dialog"},ht={class:"dialog-body"},wt={class:"form-group"},gt=["value"],bt={class:"form-group checkbox-group"},kt={class:"dialog-footer"},yt=["disabled"],ft=le({__name:"TeamPage",setup(l){ce();const{initUser:n}=ne(),u=v(!0),d=v(""),o=v(null),x=v([]),$=v([]),F=v([]),C=v(!1),M=v(!1),D=v(!1),T=v(!1),B=v(""),R=v(""),V=v(""),U=v(""),j=v(""),f=v(""),H=v(!1),L=S(()=>x.value.find(a=>a.feishu_user_id===d.value)),Z=S(()=>{var a;return((a=L.value)==null?void 0:a.role)==="owner"}),J=S(()=>{var a,e;return((a=L.value)==null?void 0:a.role)==="owner"||((e=L.value)==null?void 0:e.role)==="admin"}),q=a=>{switch(a){case"owner":return"所有者";case"admin":return"管理员";default:return"成员"}},y=async()=>{u.value=!0;try{d.value=await ue.bridge.getUserId(),await n(),o.value=await w.getMyTeam(d.value),o.value&&(x.value=await w.getMembers(o.value.id,d.value),$.value=await w.getTeamTemplates(o.value.id,d.value));const a=await me.getAll();F.value=a.map(e=>({id:e.id,name:e.name}))}catch(a){console.error("加载团队数据失败:",a)}finally{u.value=!1}},G=async()=>{var a,e;if(B.value.trim())try{o.value=await w.createTeam(d.value,B.value,R.value),C.value=!1,c.success("团队创建成功"),await y()}catch(s){c.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.detail)||"创建失败")}},K=async()=>{var a,e;if(V.value.trim())try{const s=await w.acceptInvite(d.value,V.value);M.value=!1,c.success(`成功加入团队：${s.team_name}`),await y()}catch(s){c.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.detail)||"加入失败")}},Q=async()=>{var a,e;if(o.value)try{const s=U.value.trim()||void 0,p=await w.inviteMember(o.value.id,d.value,s);j.value=p.invite_code}catch(s){c.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.detail)||"生成邀请码失败")}},W=()=>{D.value=!1,U.value="",j.value=""},Y=async a=>{var p,O;if(!o.value)return;const e=a.role==="admin"?"member":"admin",s=e==="admin"?"管理员":"普通成员";try{await I.confirm(`确定将 ${a.nickname||a.feishu_user_id} 设为${s}？`,"更改角色"),await w.updateMemberRole(o.value.id,a.id,d.value,e),c.success("角色已更新"),await y()}catch(X){X!=="cancel"&&c.error(((O=(p=X.response)==null?void 0:p.data)==null?void 0:O.detail)||"更新失败")}},ee=async a=>{var e,s;if(o.value)try{await I.confirm(`确定移除成员 ${a.nickname||a.feishu_user_id}？`,"移除成员",{type:"warning"}),await w.removeMember(o.value.id,a.id,d.value),c.success("成员已移除"),await y()}catch(p){p!=="cancel"&&c.error(((s=(e=p.response)==null?void 0:e.data)==null?void 0:s.detail)||"移除失败")}},te=async()=>{var a,e;if(o.value)try{await I.confirm("确定退出当前团队？","退出团队",{type:"warning"}),await w.leaveTeam(o.value.id,d.value),c.success("已退出团队"),o.value=null,x.value=[],$.value=[]}catch(s){s!=="cancel"&&c.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.detail)||"退出失败")}},se=async()=>{var a,e;if(o.value)try{await I.confirm("确定要解散团队吗？此操作将删除团队及其所有数据，且无法恢复。","解散团队",{type:"warning",confirmButtonText:"确定解散",cancelButtonText:"取消",confirmButtonClass:"el-button--danger"}),await w.dissolveTeam(o.value.id,d.value),c.success("团队已解散"),o.value=null,x.value=[],$.value=[]}catch(s){s!=="cancel"&&c.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.detail)||"解散失败")}},ae=async()=>{var a,e;if(!(!o.value||!f.value))try{await w.shareTemplate(o.value.id,d.value,f.value,H.value),T.value=!1,f.value="",H.value=!1,c.success("模版已共享"),await y()}catch(s){c.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.detail)||"共享失败")}},oe=async a=>{var e,s;if(o.value)try{await I.confirm(`确定取消共享模版 ${a.template_name}？`,"取消共享"),await w.unshareTemplate(o.value.id,a.id,d.value),c.success("已取消共享"),await y()}catch(p){p!=="cancel"&&c.error(((s=(e=p.response)==null?void 0:e.data)==null?void 0:s.detail)||"操作失败")}};return ie(()=>{y()}),(a,e)=>(r(),i("div",he,[t("div",we,[t("button",{onClick:e[0]||(e[0]=s=>a.$router.push("/")),class:"btn-back"},e[18]||(e[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"m15 18-6-6 6-6"})],-1),k(" 返回 ")]))]),u.value?(r(),i("div",ge,e[19]||(e[19]=[t("div",{class:"spinner"},null,-1),t("p",null,"加载中...",-1)]))):o.value?(r(),i("div",fe,[t("div",_e,[t("div",xe,[e[23]||(e[23]=A('<div class="team-icon" data-v-881ab3db><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-881ab3db><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" data-v-881ab3db></path><circle cx="9" cy="7" r="4" data-v-881ab3db></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87" data-v-881ab3db></path><path d="M16 3.13a4 4 0 0 1 0 7.75" data-v-881ab3db></path></svg></div>',1)),t("div",$e,[t("h1",Ce,g(o.value.name),1),t("p",Me,g(o.value.description||"暂无描述"),1)])]),t("div",Te,[t("div",Be,[t("span",Ve,g(o.value.member_count),1),t("span",je,"/ "+g(o.value.max_members)+" 成员",1)])])]),t("div",Ie,[t("div",De,[e[25]||(e[25]=A('<h2 class="section-title" data-v-881ab3db><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-881ab3db><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" data-v-881ab3db></path><circle cx="9" cy="7" r="4" data-v-881ab3db></circle><line x1="19" x2="19" y1="8" y2="14" data-v-881ab3db></line><line x1="22" x2="16" y1="11" y2="11" data-v-881ab3db></line></svg> 团队成员 </h2>',1)),J.value?(r(),i("button",{key:0,onClick:e[3]||(e[3]=s=>D.value=!0),class:"btn-sm btn-primary"},e[24]||(e[24]=[A('<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-881ab3db><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" data-v-881ab3db></path><circle cx="9" cy="7" r="4" data-v-881ab3db></circle><line x1="19" x2="19" y1="8" y2="14" data-v-881ab3db></line><line x1="22" x2="16" y1="11" y2="11" data-v-881ab3db></line></svg> 邀请成员 ',2)]))):b("",!0)]),t("div",Ue,[(r(!0),i(z,null,P(x.value,s=>(r(),i("div",{key:s.id,class:"member-item"},[t("div",He,g((s.nickname||s.feishu_user_id).charAt(0).toUpperCase()),1),t("div",Ae,[t("span",Ne,g(s.nickname||s.feishu_user_id),1),t("span",{class:ve(["member-role",s.role])},g(q(s.role)),3)]),Z.value&&s.role!=="owner"?(r(),i("div",Ee,[t("button",{onClick:p=>Y(s),class:"btn-icon",title:"更改角色"},e[26]||(e[26]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M12 20h9"}),t("path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"})],-1)]),8,Re),t("button",{onClick:p=>ee(s),class:"btn-icon btn-danger",title:"移除成员"},e[27]||(e[27]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),t("circle",{cx:"9",cy:"7",r:"4"}),t("line",{x1:"17",x2:"22",y1:"11",y2:"11"})],-1)]),8,Le)])):b("",!0)]))),128))])]),t("div",Se,[t("div",ze,[e[29]||(e[29]=t("h2",{class:"section-title"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),t("polyline",{points:"14 2 14 8 20 8"})]),k(" 共享模版 ")],-1)),t("button",{onClick:e[4]||(e[4]=s=>T.value=!0),class:"btn-sm btn-outline"},e[28]||(e[28]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"}),t("polyline",{points:"16 6 12 2 8 6"}),t("line",{x1:"12",x2:"12",y1:"2",y2:"15"})],-1),k(" 共享模版 ")]))]),$.value.length===0?(r(),i("div",Pe,e[30]||(e[30]=[t("p",null,"暂无共享模版",-1)]))):(r(),i("div",Fe,[(r(!0),i(z,null,P($.value,s=>(r(),i("div",{key:s.id,class:"template-item"},[t("div",Ze,[t("span",Je,g(s.template_name),1),t("span",Oe,[k(" 由 "+g(s.shared_by_nickname||"未知")+" 共享 ",1),s.can_edit?(r(),i("span",Xe,"可编辑")):b("",!0)])]),J.value?(r(),i("div",qe,[t("button",{onClick:p=>oe(s),class:"btn-icon btn-danger",title:"取消共享"},e[31]||(e[31]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M3 6h18"}),t("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),t("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})],-1)]),8,Ge)])):b("",!0)]))),128))]))]),t("div",Ke,[Z.value?(r(),i("button",{key:0,onClick:se,class:"btn-danger-outline"},e[32]||(e[32]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M3 6h18"}),t("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),t("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})],-1),k(" 解散团队 ")]))):(r(),i("button",{key:1,onClick:te,class:"btn-danger-outline"},e[33]||(e[33]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),t("polyline",{points:"16 17 21 12 16 7"}),t("line",{x1:"21",x2:"9",y1:"12",y2:"12"})],-1),k(" 退出团队 ")])))])])):(r(),i("div",be,[t("div",ke,[e[22]||(e[22]=A('<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-users" data-v-881ab3db><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" data-v-881ab3db></path><circle cx="9" cy="7" r="4" data-v-881ab3db></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87" data-v-881ab3db></path><path d="M16 3.13a4 4 0 0 1 0 7.75" data-v-881ab3db></path></svg><h2 data-v-881ab3db>您还没有团队</h2><p data-v-881ab3db>创建团队开始协作，或输入邀请码加入现有团队</p>',3)),t("div",ye,[t("button",{onClick:e[1]||(e[1]=s=>C.value=!0),class:"btn-primary"},e[20]||(e[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M12 5v14"}),t("path",{d:"M5 12h14"})],-1),k(" 创建团队 ")])),t("button",{onClick:e[2]||(e[2]=s=>M.value=!0),class:"btn-outline"},e[21]||(e[21]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),t("polyline",{points:"10 17 15 12 10 7"}),t("line",{x1:"15",x2:"3",y1:"12",y2:"12"})],-1),k(" 加入团队 ")]))])])])),C.value?(r(),i("div",{key:3,class:"dialog-overlay",onClick:e[8]||(e[8]=N(s=>C.value=!1,["self"]))},[t("div",Qe,[e[36]||(e[36]=t("h3",{class:"dialog-title"},"创建团队",-1)),t("div",We,[t("div",Ye,[e[34]||(e[34]=t("label",null,"团队名称",-1)),_(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>B.value=s),type:"text",placeholder:"请输入团队名称",maxlength:"50"},null,512),[[E,B.value]])]),t("div",et,[e[35]||(e[35]=t("label",null,"团队描述 (可选)",-1)),_(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>R.value=s),placeholder:"请输入团队描述",maxlength:"200"},null,512),[[E,R.value]])])]),t("div",tt,[t("button",{onClick:e[7]||(e[7]=s=>C.value=!1),class:"btn-outline"},"取消"),t("button",{onClick:G,class:"btn-primary",disabled:!B.value.trim()},"创建",8,st)])])])):b("",!0),M.value?(r(),i("div",{key:4,class:"dialog-overlay",onClick:e[11]||(e[11]=N(s=>M.value=!1,["self"]))},[t("div",at,[e[38]||(e[38]=t("h3",{class:"dialog-title"},"加入团队",-1)),t("div",ot,[t("div",lt,[e[37]||(e[37]=t("label",null,"邀请码",-1)),_(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>V.value=s),type:"text",placeholder:"请输入邀请码"},null,512),[[E,V.value]])])]),t("div",nt,[t("button",{onClick:e[10]||(e[10]=s=>M.value=!1),class:"btn-outline"},"取消"),t("button",{onClick:K,class:"btn-primary",disabled:!V.value.trim()},"加入",8,it)])])])):b("",!0),D.value?(r(),i("div",{key:5,class:"dialog-overlay",onClick:e[13]||(e[13]=N(s=>D.value=!1,["self"]))},[t("div",rt,[e[43]||(e[43]=t("h3",{class:"dialog-title"},"邀请成员",-1)),t("div",dt,[t("div",ut,[e[39]||(e[39]=t("label",null,"被邀请人飞书用户ID（可选）",-1)),_(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>U.value=s),type:"text",placeholder:"留空则生成通用邀请码，任何人都可使用"},null,512),[[E,U.value]]),e[40]||(e[40]=t("p",{class:"form-hint"},"如果不填写，将生成通用邀请码，任何知道邀请码的用户都可以加入团队",-1))]),j.value?(r(),i("div",vt,[e[41]||(e[41]=t("p",null,"邀请码已生成：",-1)),t("div",ct,g(j.value),1),e[42]||(e[42]=t("p",{class:"invite-tip"},"请将此邀请码发送给被邀请人，有效期7天",-1))])):b("",!0)]),t("div",pt,[t("button",{onClick:W,class:"btn-outline"},"关闭"),j.value?b("",!0):(r(),i("button",{key:0,onClick:Q,class:"btn-primary"},"生成邀请码"))])])])):b("",!0),T.value?(r(),i("div",{key:6,class:"dialog-overlay",onClick:e[17]||(e[17]=N(s=>T.value=!1,["self"]))},[t("div",mt,[e[47]||(e[47]=t("h3",{class:"dialog-title"},"共享模版到团队",-1)),t("div",ht,[t("div",wt,[e[45]||(e[45]=t("label",null,"选择模版",-1)),_(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>f.value=s)},[e[44]||(e[44]=t("option",{value:""},"请选择模版",-1)),(r(!0),i(z,null,P(F.value,s=>(r(),i("option",{key:s.id,value:s.id},g(s.name),9,gt))),128))],512),[[re,f.value]])]),t("div",bt,[t("label",null,[_(t("input",{type:"checkbox","onUpdate:modelValue":e[15]||(e[15]=s=>H.value=s)},null,512),[[de,H.value]]),e[46]||(e[46]=k(" 允许团队成员编辑 "))])])]),t("div",kt,[t("button",{onClick:e[16]||(e[16]=s=>T.value=!1),class:"btn-outline"},"取消"),t("button",{onClick:ae,class:"btn-primary",disabled:!f.value},"共享",8,yt)])])])):b("",!0)]))}}),$t=pe(ft,[["__scopeId","data-v-881ab3db"]]);export{$t as default};
