import{d as P,u as A,r as p,o as N,E as h,a as Z,c as n,b as e,e as w,f as g,w as D,v as Q,n as f,g as m,t as x,F as R,h as U,i as z,j as i,k as O,l as G,_ as J}from"./index-mInWaxl3.js";import{t as T}from"./templates-DCFN9nDS.js";import{s as K}from"./sanitize-Cd_e7NsO.js";import"./purify.es-B9ZVCkUG.js";const W={class:"template-library"},X={class:"library-container"},Y={class:"filter-section"},tt={class:"filter-row"},et={class:"search-box"},ot={class:"category-tabs"},st={key:0,class:"search-result-info"},at={key:0,class:"loading-state"},rt={key:1,class:"empty-state"},nt={class:"empty-icon"},it={key:0,xmlns:"http://www.w3.org/2000/svg",width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},lt={key:1,xmlns:"http://www.w3.org/2000/svg",width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},dt={key:2,class:"templates-grid"},ct=["onClick"],vt=["innerHTML"],ut={class:"card-footer"},ht={class:"card-info"},pt={class:"card-title"},wt={key:0,class:"system-badge",title:"系统模版"},gt={class:"card-actions"},mt=["onClick"],kt=["onClick"],yt=P({__name:"TemplateLibrary",setup(bt){const B=s=>{const t=s||"";if(!t.trim())return t;try{const o=new DOMParser,a=t.includes("<html")||t.includes("<body")?t:`<html><body>${t}</body></html>`,u=o.parseFromString(a,"text/html").getElementById("template-root");if(!u)return t;const _=u.querySelectorAll(".template-page");if(_.length>0){const F=_[0];u.innerHTML="",u.appendChild(F)}return u.outerHTML}catch{return t}},c=z(),H=Z(),{initUser:j}=A(),v=p([]),k=p(!0),l=p(""),r=p("normal");let y=null;const d=async(s,t,o)=>{k.value=!0;try{const a=await T.getAll(s,t,o);v.value=a}catch(a){console.error("加载模板失败:",a),h.error("加载模板失败")}finally{k.value=!1}},b=s=>{r.value===s?r.value=null:r.value=s;const t=l.value.trim();r.value==="user"?d(t||void 0,void 0,"me"):d(t||void 0,r.value||void 0)},L=()=>{y&&clearTimeout(y),y=setTimeout(()=>{const s=l.value.trim();r.value==="user"?d(s||void 0,void 0,"me"):d(s||void 0,r.value||void 0)},300)},M=()=>{l.value="",r.value==="user"?d(void 0,void 0,"me"):d(void 0,r.value||void 0)},S=s=>{c.push({name:"editor",query:{templateId:String(s)}})},V=()=>{c.push({name:"editor",query:{mode:"create"}})},q=s=>{c.push({name:"editor",query:{templateId:String(s.id),mode:"edit"}})},I=async s=>{var t,o;try{await G.confirm("确定要删除此模板吗？","删除模板",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await T.delete(s),h.success("模板已删除");const a=l.value.trim();r.value==="user"?d(a||void 0,void 0,"me"):d(a||void 0,r.value||void 0)}catch(a){if(a!=="cancel"){console.error("删除模板失败:",a);const C=((o=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:o.detail)||"删除模板失败";h.error(C)}}},$=()=>{c.push("/editor")},E=()=>{c.push("/")};return N(async()=>{try{if(await j(),!localStorage.getItem("session_token")){console.error("[TemplateLibrary] 初始化后仍然没有 token!"),h.error("用户认证失败，请刷新页面重试");return}const o=H.query.category||"normal";r.value=o,o==="user"?await d(void 0,void 0,"me"):await d(void 0,o)}catch(s){console.error("[TemplateLibrary] 初始化失败:",s),h.error("初始化失败，请刷新页面重试")}}),(s,t)=>(i(),n("div",W,[e("header",{class:"library-header"},[e("div",{class:"header-left"},[e("button",{onClick:E,class:"btn btn-secondary"},t[4]||(t[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m12 19-7-7 7-7"}),e("path",{d:"M19 12H5"})],-1),w(" 返回 ")]))]),t[6]||(t[6]=e("div",{class:"header-center"},[e("h1",{class:"library-title"},"模板库"),e("p",{class:"library-subtitle"},"选择模板开始创作")],-1)),e("div",{class:"header-right"},[e("button",{onClick:V,class:"btn btn-primary"},t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M5 12h14"}),e("path",{d:"M12 5v14"})],-1),w(" 新建模板 ")]))])]),e("div",X,[e("div",Y,[e("div",tt,[e("div",et,[t[8]||(t[8]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"search-icon"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.35-4.35"})],-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>l.value=o),onInput:L,type:"text",placeholder:"搜索模板名称...",class:"search-input"},null,544),[[Q,l.value]]),l.value?(i(),n("button",{key:0,onClick:M,class:"clear-btn",title:"清除搜索"},t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M18 6 6 18"}),e("path",{d:"m6 6 12 12"})],-1)]))):g("",!0)]),e("div",ot,[e("button",{onClick:t[1]||(t[1]=o=>b("normal")),class:f(["category-tab",{active:r.value==="normal"}])},t[9]||(t[9]=[m('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9d8b325c><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" data-v-9d8b325c></path><path d="M14 2v4a2 2 0 0 0 2 2h4" data-v-9d8b325c></path><path d="M10 9H8" data-v-9d8b325c></path><path d="M16 13H8" data-v-9d8b325c></path><path d="M16 17H8" data-v-9d8b325c></path></svg><span data-v-9d8b325c>模版</span>',2)]),2),e("button",{onClick:t[2]||(t[2]=o=>b("ai")),class:f(["category-tab",{active:r.value==="ai"}])},t[10]||(t[10]=[m('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9d8b325c><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" data-v-9d8b325c></path><path d="M5 3v4" data-v-9d8b325c></path><path d="M9 3v4" data-v-9d8b325c></path><path d="M3 5h4" data-v-9d8b325c></path><path d="M3 9h4" data-v-9d8b325c></path></svg><span data-v-9d8b325c>AI模版</span>',2)]),2),e("button",{onClick:t[3]||(t[3]=o=>b("user")),class:f(["category-tab",{active:r.value==="user"}])},t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1),e("span",null,"我的模版",-1)]),2)])]),(l.value||r.value)&&v.value.length>0?(i(),n("div",st," 找到 "+x(v.value.length)+" 个模板 ",1)):g("",!0)]),k.value?(i(),n("div",at,t[12]||(t[12]=[e("div",{class:"loading-icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"animate-spin"},[e("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})])],-1),e("p",null,"加载模板中...",-1)]))):v.value.length===0?(i(),n("div",rt,[e("div",nt,[l.value?(i(),n("svg",it,t[13]||(t[13]=[e("circle",{cx:"11",cy:"11",r:"8"},null,-1),e("path",{d:"m21 21-4.35-4.35"},null,-1)]))):(i(),n("svg",lt,t[14]||(t[14]=[m('<path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" data-v-9d8b325c></path><path d="M14 2v4a2 2 0 0 0 2 2h4" data-v-9d8b325c></path><path d="M10 9H8" data-v-9d8b325c></path><path d="M16 13H8" data-v-9d8b325c></path><path d="M16 17H8" data-v-9d8b325c></path>',5)])))]),e("p",null,x(l.value?"未找到匹配的模板":"暂无模板"),1),l.value?(i(),n("button",{key:1,onClick:M,class:"btn btn-secondary"}," 清除搜索 ")):(i(),n("button",{key:0,onClick:$,class:"btn btn-primary"},t[15]||(t[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M5 12h14"}),e("path",{d:"M12 5v14"})],-1),w(" 创建第一个模板 ")])))])):(i(),n("div",dt,[(i(!0),n(R,null,U(v.value,o=>(i(),n("div",{key:o.id,class:"template-card"},[e("div",{class:"card-preview",onClick:a=>S(o.id)},[e("div",{class:"preview-content",innerHTML:O(K)(B(o.content))},null,8,vt)],8,ct),e("div",ut,[e("div",ht,[e("h3",pt,[w(x(o.name)+" ",1),o.is_system?(i(),n("span",wt,"系统")):g("",!0)])]),e("div",gt,[e("button",{onClick:a=>q(o),class:"btn-icon",title:"编辑"},t[16]||(t[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),e("path",{d:"m15 5 4 4"})],-1)]),8,mt),o.is_system?g("",!0):(i(),n("button",{key:0,onClick:a=>I(o.id),class:"btn-icon delete",title:"删除"},t[17]||(t[17]=[m('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9d8b325c><path d="M3 6h18" data-v-9d8b325c></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" data-v-9d8b325c></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" data-v-9d8b325c></path><line x1="10" x2="10" y1="11" y2="17" data-v-9d8b325c></line><line x1="14" x2="14" y1="11" y2="17" data-v-9d8b325c></line></svg>',1)]),8,kt))])])]))),128))]))])]))}}),_t=J(yt,[["__scopeId","data-v-9d8b325c"]]);export{_t as default};
