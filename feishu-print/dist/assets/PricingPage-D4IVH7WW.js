import{$ as b,d as J,u as L,X as x,c as d,f as D,k as f,b as a,n as P,t as r,F as O,e as C,P as X,j as u,_ as Z,r as o,o as ra,M as ia,q as da,i as ua,C as G,w as ca,v as va,a1 as pa,g as Q,E as $,l as fa}from"./index-mInWaxl3.js";import{Q as _a}from"./browser-D0zWCZlH.js";const B="https://zhinengpaiban.cn",T={async getPlans(){return(await b.get(`${B}/api/payment/plans`)).data},async createOrder(l,e){return(await b.post(`${B}/api/payment/create-order`,{feishu_user_id:l,plan_type:e})).data},async createAlipayNativePay(l,e){return(await b.post(`${B}/api/payment/alipay/create`,{feishu_user_id:l,plan_type:e})).data},async getOrderStatus(l){return(await b.get(`${B}/api/payment/alipay/query`,{params:{order_no:l}})).data},async getOrders(l){return(await b.get(`${B}/api/payment/orders`,{params:{feishu_user_id:l}})).data}},Y="https://zhinengpaiban.cn",ma={async generate(l,e=30,c=1,h){return(await b.post(`${Y}/api/promo/generate`,{plan_type:l,duration_days:e,max_uses:c,expires_at:h})).data},async redeem(l,e){return(await b.post(`${Y}/api/promo/redeem`,{code:l,feishu_user_id:e})).data},async list(){return(await b.get(`${Y}/api/promo/list`)).data}},ga={key:0,class:"quota-section"},ba={class:"quota-card"},ha={class:"quota-header"},ya={class:"user-info"},wa={class:"quota-metrics"},ka={class:"metric-item"},$a={class:"metric-label"},xa={class:"metric-value"},Ca={class:"progress-track"},Pa={class:"metric-item"},Ma={class:"metric-label"},Ia={class:"metric-value"},qa={class:"progress-track"},Ba=J({__name:"QuotaBar",setup(l){const{userStatus:e,planName:c}=L(),h=x(()=>{if(!e.value||e.value.pdf_exports_limit===-1)return 0;if(e.value.pdf_exports_limit===0)return 100;const v=e.value.pdf_exports_used/e.value.pdf_exports_limit*100;return Math.min(100,Math.max(0,v))}),M=x(()=>{if(!e.value||e.value.ai_generates_limit===-1)return 0;if(e.value.ai_generates_limit===0)return 100;const v=e.value.ai_generates_used/e.value.ai_generates_limit*100;return Math.min(100,Math.max(0,v))});return(v,i)=>f(e)?(u(),d("div",ga,[a("div",ba,[a("div",ha,[a("div",ya,[a("span",{class:P(["plan-tag",f(e).plan_type])},r(f(c)),3),i[0]||(i[0]=a("span",{class:"welcome-text"},"当前权益使用情况",-1))])]),a("div",wa,[a("div",ka,[a("div",$a,[i[1]||(i[1]=a("span",null,"导出",-1)),a("span",xa,[f(e).pdf_exports_limit===-1?(u(),d(O,{key:0},[C("无限量")],64)):(u(),d(O,{key:1},[C(r(f(e).pdf_exports_used)+" / "+r(f(e).pdf_exports_limit),1)],64))])]),a("div",Ca,[a("div",{class:P(["progress-bar",{"is-full":h.value>=100}]),style:X({width:`${h.value}%`})},null,6)])]),a("div",Pa,[a("div",Ma,[i[2]||(i[2]=a("span",null,"AI 生成",-1)),a("span",Ia,[f(e).ai_generates_limit===-1?(u(),d(O,{key:0},[C("无限量")],64)):(u(),d(O,{key:1},[C(r(f(e).ai_generates_used)+" / "+r(f(e).ai_generates_limit),1)],64))])]),a("div",qa,[a("div",{class:P(["progress-bar ai-bar",{"is-full":M.value>=100}]),style:X({width:`${M.value}%`})},null,6)])])])])])):D("",!0)}}),Aa=Z(Ba,[["__scopeId","data-v-becc61c8"]]),Sa={class:"pricing-page"},Fa={class:"pricing-nav"},Na={class:"dialog"},Oa={class:"dialog-header"},Da={class:"dialog-body"},Ea={class:"promo-input-wrapper"},Ra={class:"dialog-footer"},Ua=["disabled"],Va={class:"plans-container"},ja={class:"plan-card"},za={class:"card-footer"},Qa={class:"btn btn-outline",disabled:""},Ta={class:"card-header"},Ya={class:"plan-price"},Ka={class:"amount"},Wa={class:"card-footer"},Ha=["disabled"],Xa={class:"card-header"},Ga={class:"plan-price"},Ja={class:"amount"},La={class:"card-footer"},Za=["disabled"],as={class:"dialog pay-dialog"},ss={class:"dialog-body pay-dialog-body"},es={class:"qr-code-wrapper"},ts=["src"],ns={class:"order-info"},ls={class:"order-amount"},os={class:"order-no"},rs={key:0,class:"countdown-tip"},is={key:1,class:"countdown-tip expired"},ds=J({__name:"PricingPage",setup(l){const e=ua(),{userStatus:c,refreshStatus:h,initUser:M}=L(),v=o(null),i=o(!1),_=o(""),A=o(!1),w=o(""),S=o("success"),E=o(!1),R=o(null),U=o(""),V=o(""),F=o(""),k=o(600),m=o(null),p=o(null),K=x(()=>F.value&&F.value.startsWith("data:image")),I=o([]),aa={mounted:t=>t.focus()},y=x(()=>{var t;return((t=c.value)==null?void 0:t.plan_type)||"free"}),j=t=>{const s=Math.round(t||0)/100,n=s.toFixed(2);return n.endsWith(".00")?String(Math.round(s)):n.replace(/0+$/,"").replace(/\.$/,"")},sa=x(()=>{const t=I.value.find(s=>s.id==="pro");return j(t==null?void 0:t.price)}),ea=x(()=>{const t=I.value.find(s=>s.id==="team");return j(t==null?void 0:t.price)}),ta=async()=>{try{const t=await T.getPlans();I.value=t.plans||[]}catch{I.value=[]}},W=async t=>{var s,n;if(!c.value){$.error("请先初始化用户");return}try{v.value=t,await fa.confirm(`确定要升级到${t==="pro"?"专业版":"团队版"}吗？`,"确认升级",{confirmButtonText:"确认支付",cancelButtonText:"取消",type:"info"});const g=I.value.find(z=>z.id===t),oa=g?j(g.price):"0",q=await T.createAlipayNativePay(c.value.feishu_user_id,t);if(U.value=q.order_no,V.value=oa,F.value=q.qr_code_url||"",k.value=600,!K.value&&R.value&&q.qr_code_url)try{await _a.toCanvas(R.value,q.qr_code_url,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}})}catch(z){console.error("生成二维码失败:",z),$.error("生成二维码失败，请重试");return}E.value=!0,na(q.order_no),la()}catch(g){if(g==="cancel")return;console.error("Purchase failed:",g),$.error(((n=(s=g.response)==null?void 0:s.data)==null?void 0:n.detail)||"无法完成购买，请重试")}finally{v.value=null}},na=t=>{m.value&&clearInterval(m.value),m.value=window.setInterval(async()=>{try{(await T.getOrderStatus(t)).status==="paid"&&($.success("支付成功！享受您的新权益。"),await h(),N())}catch(s){console.error("查询订单状态失败:",s)}},6e3)},la=()=>{p.value&&clearInterval(p.value),p.value=window.setInterval(()=>{k.value>0?k.value--:p.value&&(clearInterval(p.value),p.value=null)},1e3)},N=()=>{E.value=!1,m.value&&(clearInterval(m.value),m.value=null),p.value&&(clearInterval(p.value),p.value=null),U.value="",V.value="",k.value=600},H=async()=>{var t,s;if(!_.value||_.value.length!==12){w.value="请输入有效的12位邀请码",S.value="error";return}if(!c.value){$.error("请先初始化用户");return}try{A.value=!0,w.value="";const n=await ma.redeem(_.value.toUpperCase(),c.value.feishu_user_id);n.success?($.success("兑换成功！权益已生效"),await h(),_.value="",i.value=!1):(w.value=n.message||"无效的邀请码",S.value="error")}catch(n){const g=((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.detail)||"兑换服务暂时不可用";w.value=g,S.value="error"}finally{A.value=!1}};return ra(async()=>{await M(),await ta()}),ia(()=>{m.value&&clearInterval(m.value),p.value&&clearInterval(p.value)}),(t,s)=>(u(),d("div",Sa,[a("nav",Fa,[a("button",{onClick:s[0]||(s[0]=n=>f(e).push("/")),class:"nav-back"},s[8]||(s[8]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("path",{d:"m15 18-6-6 6-6"})],-1)])),a("button",{onClick:s[1]||(s[1]=n=>i.value=!0),class:"btn-redeem-trigger"},s[9]||(s[9]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("path",{d:"M20.91 8.84 5.91 2.23a1 1 0 0 0-1.24 1.37l2.35 6.4h9.91a1 1 0 0 1 0 2H7.02l-2.35 6.4a1 1 0 0 0 1.24 1.37l15-6.61a1 1 0 0 0 0-1.83z"})],-1),C(" 兑换邀请码 ")]))]),i.value?(u(),d("div",{key:0,class:"dialog-overlay",onClick:s[5]||(s[5]=G(n=>i.value=!1,["self"]))},[a("div",Na,[a("div",Oa,[s[11]||(s[11]=a("h3",null,"兑换会员权益",-1)),a("button",{onClick:s[2]||(s[2]=n=>i.value=!1),class:"btn-close"},s[10]||(s[10]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("path",{d:"M18 6 6 18"}),a("path",{d:"m6 6 12 12"})],-1)]))]),a("div",Da,[s[12]||(s[12]=a("p",{class:"dialog-desc"},"如果您持有活动邀请码，请输入以解锁相应权益。",-1)),a("div",Ea,[ca(a("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>_.value=n),type:"text",placeholder:"请输入12位邀请码",class:"promo-input",maxlength:"12",onKeyup:pa(H,["enter"])},null,544),[[va,_.value],[aa]])]),w.value?(u(),d("p",{key:0,class:P(["promo-msg",S.value])},r(w.value),3)):D("",!0)]),a("div",Ra,[a("button",{onClick:s[4]||(s[4]=n=>i.value=!1),class:"btn-cancel"},"取消"),a("button",{onClick:H,class:"btn-confirm",disabled:A.value||!_.value||_.value.length!==12},r(A.value?"兑换中...":"立即兑换"),9,Ua)])])])):D("",!0),da(Aa),s[27]||(s[27]=a("div",{class:"pricing-header"},[a("h1",{class:"page-title"},"选择适合您的计划"),a("p",{class:"page-subtitle"},"简单的价格，强大的功能。升级您的创作体验。")],-1)),a("div",Va,[a("div",ja,[s[13]||(s[13]=Q('<div class="card-header" data-v-2f698ab1><h3 class="plan-name" data-v-2f698ab1>免费版</h3><div class="plan-price" data-v-2f698ab1><span class="amount" data-v-2f698ab1>0</span><span class="period" data-v-2f698ab1>/月</span></div><p class="plan-desc" data-v-2f698ab1>个人尝鲜体验</p></div><div class="card-body" data-v-2f698ab1><ul class="features-list" data-v-2f698ab1><li data-v-2f698ab1><span class="check-icon" data-v-2f698ab1>✓</span><span data-v-2f698ab1>每月 10 次导出</span></li><li data-v-2f698ab1><span class="check-icon" data-v-2f698ab1>✓</span><span data-v-2f698ab1>每月 5 次 AI 生成</span></li></ul></div>',2)),a("div",za,[a("button",Qa,r(y.value==="free"?"当前版本":"已包含"),1)])]),a("div",{class:P(["plan-card featured",{"current-plan":y.value==="pro"}])},[s[17]||(s[17]=a("div",{class:"popular-tag"},"推荐",-1)),a("div",Ta,[s[15]||(s[15]=a("h3",{class:"plan-name"},"专业版",-1)),a("div",Ya,[a("span",Ka,r(sa.value),1),s[14]||(s[14]=a("span",{class:"period"},"/月",-1))]),s[16]||(s[16]=a("p",{class:"plan-desc"},"适合个人创作者",-1))]),s[18]||(s[18]=Q('<div class="card-body" data-v-2f698ab1><ul class="features-list" data-v-2f698ab1><li data-v-2f698ab1><span class="check-icon" data-v-2f698ab1>✓</span><span data-v-2f698ab1><strong data-v-2f698ab1>每月 500 次</strong> 导出</span></li><li data-v-2f698ab1><span class="check-icon" data-v-2f698ab1>✓</span><span data-v-2f698ab1><strong data-v-2f698ab1>每月 50 次</strong> AI 生成</span></li><li data-v-2f698ab1><span class="check-icon" data-v-2f698ab1>✓</span><span data-v-2f698ab1>优先电子签名支持</span></li></ul></div>',1)),a("div",Wa,[a("button",{class:"btn btn-primary",onClick:s[6]||(s[6]=n=>W("pro")),disabled:!!v.value||y.value==="pro"},r(v.value==="pro"?"处理中...":y.value==="pro"?"当前版本":"立即升级"),9,Ha)])],2),a("div",{class:P(["plan-card",{"current-plan":y.value==="team"}])},[a("div",Xa,[s[20]||(s[20]=a("h3",{class:"plan-name"},"团队版",-1)),a("div",Ga,[a("span",Ja,r(ea.value),1),s[19]||(s[19]=a("span",{class:"period"},"/月",-1))]),s[21]||(s[21]=a("p",{class:"plan-desc"},"适合小型团队",-1))]),s[22]||(s[22]=Q('<div class="card-body" data-v-2f698ab1><ul class="features-list" data-v-2f698ab1><li data-v-2f698ab1><span class="check-icon" data-v-2f698ab1>✓</span><span data-v-2f698ab1><strong data-v-2f698ab1>无限量</strong> 导出</span></li><li data-v-2f698ab1><span class="check-icon" data-v-2f698ab1>✓</span><span data-v-2f698ab1><strong data-v-2f698ab1>每月 200 次</strong> AI 生成</span></li><li data-v-2f698ab1><span class="check-icon" data-v-2f698ab1>✓</span><span data-v-2f698ab1>团队协作与管理</span></li></ul></div>',1)),a("div",La,[a("button",{class:"btn btn-outline",onClick:s[7]||(s[7]=n=>W("team")),disabled:!!v.value||y.value==="team"},r(v.value==="team"?"处理中...":y.value==="team"?"当前版本":"立即升级"),9,Za)])],2)]),E.value?(u(),d("div",{key:1,class:"dialog-overlay",onClick:G(N,["self"])},[a("div",as,[a("div",{class:"dialog-header"},[s[24]||(s[24]=a("h3",null,"扫码支付",-1)),a("button",{onClick:N,class:"btn-close"},s[23]||(s[23]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("path",{d:"M18 6 6 18"}),a("path",{d:"m6 6 12 12"})],-1)]))]),a("div",ss,[s[26]||(s[26]=a("p",{class:"pay-tip"},"请使用支付宝扫码支付",-1)),a("div",es,[K.value?(u(),d("img",{key:0,src:F.value,class:"qr-code-img",alt:"支付二维码"},null,8,ts)):(u(),d("canvas",{key:1,ref_key:"qrCodeCanvas",ref:R,class:"qr-code-canvas"},null,512))]),a("div",ns,[a("p",ls,[s[25]||(s[25]=C("支付金额：")),a("strong",null,"¥"+r(V.value),1)]),a("p",os,"订单号："+r(U.value),1)]),k.value>0?(u(),d("p",rs,"请在 "+r(k.value)+" 秒内完成支付",1)):(u(),d("p",is,"支付已超时，请重新下单"))]),a("div",{class:"dialog-footer"},[a("button",{onClick:N,class:"btn-cancel"},"取消支付")])])])):D("",!0)]))}}),vs=Z(ds,[["__scopeId","data-v-2f698ab1"]]);export{vs as default};
